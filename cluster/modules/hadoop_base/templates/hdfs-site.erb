<% @namenode = 
      eval(@nodes).select {|node| node[:roles].include? 'nn'}[0][:hostname] +
      "." + @domain;
  -%>
<?xml version="1.0"?>
<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>

<configuration>

  <property>
    <name>dfs.name.dir</name>
    <value><%= @data_dir %>/hdfs/nn</value>
  </property>

  <property>
    <name>dfs.support.append</name>
    <value>false</value>
  </property>

  <property>
    <name>dfs.webhdfs.enabled</name>
    <value>true</value>
  </property>

  <property>
    <name>dfs.datanode.failed.volumes.tolerated</name>
    <value>0</value>
  </property>

  <property>
    <name>dfs.block.local-path-access.user</name>
    <value>hbase</value>
  </property>

  <property>
    <name>dfs.data.dir</name>
    <value><%= @data_dir %>/hdfs/dn</value>
  </property>

  <property>
    <name>dfs.replication</name>
    <value>1</value>
  </property>

  <property>
    <name>dfs.replication.max</name>
    <value>1</value>
  </property>

  <property>
    <name>dfs.heartbeat.interval</name>
    <value>3</value>
  </property>

  <property>
    <name>dfs.safemode.threshold.pct</name>
    <value>1.0f</value>
  </property>

  <property>
    <name>dfs.safemode.extension</name>
    <value>0</value>
  </property>

  <property>
    <name>dfs.balance.bandwidthPerSec</name>
    <value>6250000</value>
  </property>

  <property>
    <name>dfs.block.size</name>
    <value>134217728</value>
    <description>The default block size for new files.</description>
  </property>

  <property>
    <name>dfs.http.address</name>
    <value><%= @namenode %>:50070</value>
  </property>

  <property>
    <name>dfs.datanode.du.reserved</name>
    <value>134217728</value>
  </property>

  <property>
    <name>dfs.datanode.ipc.address</name>
    <value>0.0.0.0:8010</value>
  </property>

  <property>
    <name>dfs.blockreport.initialDelay</name>
    <value>0</value>
  </property>

  <property>
    <name>dfs.datanode.du.pct</name>
    <value>0.85f</value>
  </property>

  <property>
    <name>dfs.namenode.handler.count</name>
    <value>1</value>
  </property>

  <property>
    <name>dfs.datanode.max.xcievers</name>
    <value>4</value>
  </property>

  <property>
    <name>dfs.umaskmode</name>
    <value>077</value>
  </property>

  <property>
    <name>dfs.web.ugi</name>
    <value>gopher,gopher</value>
  </property>

  <property>
    <name>dfs.permissions</name>
    <value>true</value>
  </property>

  <property>
    <name>dfs.permissions.supergroup</name>
    <value>hadoop</value>
  </property>

  <property>
    <name>dfs.namenode.handler.count</name>
    <value>1</value>
  </property>

  <property>
    <name>ipc.server.max.response.size</name>
    <value>5242880</value>
  </property>

  <property>
    <name>dfs.block.access.token.enable</name>
    <value>true</value>
  </property>

  <property>
    <name>dfs.secondary.http.address</name>
    <value><%= @namenode %>:50090</value>
  </property>

  <property>
    <name>dfs.secondary.https.port</name>
    <value>50490</value>
  </property>

  <property>
    <name>dfs.https.port</name>
    <value>50470</value>
  </property>

  <property>
    <name>dfs.https.address</name>
    <value><%= @namenode %>:50470</value>
  </property>

  <property>
    <name>dfs.datanode.data.dir.perm</name>
    <value>750</value>
  </property>

  <property>
    <name>dfs.access.time.precision</name>
    <value>0</value>
  </property>

  <property>
    <name>dfs.cluster.administrators</name>
    <value> hdfs</value>
  </property>

  <property>
    <name>ipc.server.read.threadpool.size</name>
    <value>1</value>
  </property>

<% if @security == "true" -%>
  <property>
    <name>dfs.namenode.kerberos.internal.spnego.principal</name>
    <value>${dfs.web.authentication.kerberos.principal}</value>
  </property>

  <property>
    <name>dfs.secondary.namenode.kerberos.internal.spnego.principal</name>
    <value>${dfs.web.authentication.kerberos.principal}</value>
  </property>

  <property>
    <name>dfs.namenode.kerberos.https.principal</name>
    <value>HTTP/_HOST@<%= @realm %></value>
  </property>

  <property>
    <name>dfs.https.enable</name>
    <value>true</value>
  </property>

  <property>
    <name>dfs.web.authentication.kerberos.keytab</name>
    <value>/etc/security/hadoop/http.keytab</value>
  </property>

  <property>
    <name>dfs.datanode.kerberos.principal</name>
    <value>dn/_HOST@<%= @realm %></value>
  </property>

  <property>
    <name>dfs.namenode.keytab.file</name>
    <value>/etc/security/hadoop/nn.keytab</value>
  </property>

  <property>
    <name>dfs.secondary.namenode.keytab.file</name>
    <value>/etc/security/hadoop/nn.keytab</value>
  </property>

  <property>
    <name>dfs.datanode.keytab.file</name>
    <value>/etc/security/hadoop/dn.keytab</value>
  </property>

  <property>
    <name>dfs.namenode.kerberos.principal</name>
    <value>nn/_HOST@<%= @realm %></value>
  </property>

  <property>
    <name>dfs.secondary.namenode.kerberos.principal</name>
    <value>nn/_HOST@<%= @realm %></value>
  </property>

  <property>
    <name>dfs.web.authentication.kerberos.principal</name>
    <value>HTTP/<%= @namenode %>@<%= @realm %></value>
  </property>

  <property>
    <name>dfs.datanode.address</name>
    <value>0.0.0.0:1019</value>
  </property>

  <property>
    <name>dfs.datanode.http.address</name>
    <value>0.0.0.0:1022</value>
  </property>

<% else -%>

  <property>
    <name>dfs.datanode.address</name>
    <value>0.0.0.0:2019</value>
  </property>

  <property>
    <name>dfs.datanode.http.address</name>
    <value>0.0.0.0:2022</value>
  </property>

<% end -%>

</configuration>
